- name: install java7
  yum: name=java-1.7.0-openjdk-headless state=present

- name: install unzip
  yum: name=unzip state=present

- name: install maven
  yum: name=maven state=present

- name: install tomcat
  yum: name=tomcat state=present

- name: download phenomecentral zip
  get_url:
    dest=/pc.zip
    url={{ nexus_releases_url }}/org/phenomecentral/phenomecentral-standalone/{{ phenomecentral_version }}/{{ phenomecentral }}.zip

- name: unzip phenomecentral-standalone.zip
  unarchive: copy=no src=/pc.zip dest=/var/lib/ creates=/var/lib/{{ phenomecentral }} owner=tomcat group=tomcat
  notify:
    - restart tomcat

- name: link phenotips to phenomecentral
  file: src=/var/lib/phenomecentral dest=/var/lib/phenotips state=link force=yes
  notify:
    - restart tomcat

- name: link phenomcentral to unzipped phenomecentral
  file: src=/var/lib/{{ phenomecentral }} dest=/var/lib/phenomecentral state=link force=yes
  notify:
    - restart tomcat

- name: set environment.pernamentDirectory in xwiki.properties
  lineinfile:
    dest=/var/lib/phenomecentral/webapps/phenotips/WEB-INF/xwiki.properties
    regexp="^environment.permanentDirectory="
    line="environment.permanentDirectory=/var/lib/phenomecentral/data"
  notify:
    - restart tomcat

# SET UP TOMCAT
- name: copy tomcat config
  copy: src=catalina-root.xml dest=/etc/tomcat/Catalina/localhost/ROOT.xml owner=tomcat group=tomcat
  notify:
    - restart tomcat

## TODO: These files are non-standard on phenomecentral. find out why.
#hibernate.cfg.xml
#xwiki.cfg
#xwiki.properties
#web.xml

# TODO: Setup mysql
